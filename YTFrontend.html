<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BarneyTube â€“ YouTube Frontend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    /* Your styles here... keep it simple for now */
    body { background: #121212; color: #eee; font-family: Arial, sans-serif; }
    #resultsContainer { display: grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap: 1rem; }
    .video { cursor: pointer; background: #222; border-radius: 8px; }
    .video img { width: 100%; }
    .info { padding: 0.5rem; }
  </style>
</head>
<body>

  <input type="text" id="searchInput" placeholder="Search YouTube..." />
  <button id="searchButton">Search</button>

  <div id="playerContainer"></div>
  <div id="resultsContainer"></div>

  <script type="module">
    import { createYouTubePlayer } from './Player/youtubePlayer.js';
    import { config } from './config.js';

    const API_KEY = config.GOOGLE_API_KEY;

    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const resultsContainer = document.getElementById('resultsContainer');
    const playerContainer = document.getElementById('playerContainer');

    // Initialize gapi client and load youtube api
    async function initGapi() {
      return new Promise((resolve, reject) => {
        gapi.load('client', async () => {
          try {
            await gapi.client.init({ apiKey: API_KEY });
            await gapi.client.load('youtube', 'v3');
            resolve();
          } catch (e) {
            reject(e);
          }
        });
      });
    }

    async function searchVideos(query) {
      const response = await gapi.client.youtube.search.list({
        part: 'snippet',
        q: query,
        type: 'video',
        maxResults: 12,
      });
      return response.result.items;
    }

    function renderResults(videos) {
      resultsContainer.innerHTML = '';
      videos.forEach(video => {
        const vid = video.id.videoId;
        const title = video.snippet.title;
        const thumb = video.snippet.thumbnails.high.url;

        const div = document.createElement('div');
        div.className = 'video';
        div.innerHTML = `
          <img src="${thumb}" alt="${title}" />
          <div class="info"><h3>${title}</h3></div>
        `;
        div.onclick = () => {
          createYouTubePlayer('playerContainer', vid, { autoplay: true, width: '100%', height: 360 });
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        resultsContainer.appendChild(div);
      });
    }

    async function main() {
      try {
        await initGapi();
        searchButton.onclick = async () => {
          const query = searchInput.value.trim();
          if (!query) return;
          playerContainer.innerHTML = '';
          resultsContainer.innerHTML = '<p>Loading...</p>';
          try {
            const videos = await searchVideos(query);
            renderResults(videos);
          } catch (e) {
            resultsContainer.innerHTML = `<p>Error: ${e.message}</p>`;
          }
        };
      } catch (err) {
        alert('Failed to initialize YouTube API: ' + err.message);
      }
    }

    window.onload = main;
  </script>
</body>
</html>
