<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BarneyTube â€“ YouTube Search Frontend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { background:#121212; color:#eee; font-family: Arial, sans-serif; padding: 1rem; }
    #resultsContainer { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap: 1rem; margin-top: 1rem; }
    .video { cursor: pointer; background: #222; border-radius: 8px; overflow:hidden; }
    .video img { width: 100%; display: block; }
    .info { padding: 0.5rem; }
  </style>
</head>
<body>

  <input type="text" id="searchInput" placeholder="Search YouTube..." style="width: 60%; padding: 0.5rem 1rem; border-radius:9999px; border:none; background:#222; color:#eee;" />
  <button id="searchButton" style="padding: 0.5rem 1rem; border-radius:9999px; border:none; background:#bb86fc; color:#121212; font-weight:bold; cursor:pointer;">Search</button>

  <div id="playerContainer"></div>
  <div id="resultsContainer"></div>

  <script type="module">
    import { config } from './config.js';
    import { createYouTubePlayer } from './Player/youtubePlayer.js';

    const API_KEY = config.GOOGLE_API_KEY;

    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const resultsContainer = document.getElementById('resultsContainer');
    const playerContainer = document.getElementById('playerContainer');

    async function loadGapiClient() {
      return new Promise((resolve, reject) => {
        gapi.load('client', async () => {
          try {
            await gapi.client.init({ apiKey: API_KEY });
            await gapi.client.load('youtube', 'v3');
            resolve();
          } catch (e) {
            reject(e);
          }
        });
      });
    }

    async function searchVideos(query) {
      const response = await gapi.client.youtube.search.list({
        part: 'snippet',
        q: query,
        type: 'video',
        maxResults: 12,
      });
      return response.result.items;
    }

    function renderResults(videos) {
      resultsContainer.innerHTML = '';
      videos.forEach(video => {
        const vid = video.id.videoId;
        const title = video.snippet.title;
        const thumb = video.snippet.thumbnails.high.url;

        const div = document.createElement('div');
        div.className = 'video';
        div.innerHTML = `
          <img src="${thumb}" alt="${title}" />
          <div class="info"><h3>${title}</h3></div>
        `;
        div.onclick = () => {
          createYouTubePlayer('playerContainer', vid, { autoplay: true, width: '100%', height: 360 });
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        resultsContainer.appendChild(div);
      });
    }

    async function main() {
      try {
        await loadGapiClient();

        searchButton.onclick = async () => {
          const query = searchInput.value.trim();
          if (!query) return;

          playerContainer.innerHTML = '';
          resultsContainer.innerHTML = '<p>Loading...</p>';

          try {
            const videos = await searchVideos(query);
            if (videos.length === 0) {
              resultsContainer.innerHTML = '<p>No results found.</p>';
              return;
            }
            renderResults(videos);
          } catch (err) {
            resultsContainer.innerHTML = `<p>Error: ${err.message}</p>`;
          }
        };
      } catch (e) {
        alert('Google API failed to load/init: ' + (e.message || e));
        console.error(e);
      }
    }

    window.onload = main;
  </script>

</body>
</html>
